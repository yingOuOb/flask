<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åƒåˆé¤ğŸ˜</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    

</head>
<body>

    <div class="container mt-4">
    <h1 class="text-center mb-4">åƒåˆé¤ğŸ˜</h1>
    <div class="card p-4 shadow-sm">
        <div class="mb-3">
            <label for="salesperson" class="form-label">å‡ºå”®äºº</label>
            <input type="text" id="salesperson" class="form-control" placeholder="èª°å‘€:>>">
        </div>
        <div class="mb-3">
            <label for="food_name" class="form-label">å¤–é£Ÿæè¿°</label>
            <input type="text" id="food_name" class="form-control" placeholder="åƒå•¥å‘€:>>">
        </div>
        <div class="mb-3">
            <label for="food_price" class="form-label">åƒ¹æ ¼</label>
            <input type="text" id="food_price" class="form-control" placeholder="å¤šå°‘éŒ¢:>>">
        </div>
        <div class="mb-3">
            <label for="remarks" class="form-label">å‚™è¨»</label>
            <input type="text" id="remarks" class="form-control" placeholder="æœ‰ä»€éº¼æƒ³èªªçš„å‘€:>>">
        </div>
        <button onclick="sendSellFoodRequest()" class="btn btn-primary w-100">é€å‡º!!</button>
    </div>

    <p class="text-center mt-3">æƒ³å›å®¶å—?ğŸ˜º 
        <button onclick="window.location.href = '/'" class="btn btn-outline-secondary">å›é¦–é ğŸ˜º</button>
    </p>
</div>

  


<!--
    <table border="1" id="exhibit_table">
        <tr>
            <th>å‡ºå”®äºº</th>
            <th id="salesperson_exhibit"></th>
        </tr>
        <tr>
            <th>å¤–é£Ÿæè¿°</th>
            <th id="food_name_exhibit"></th>
        </tr>
        <tr>
            <th>åƒ¹æ ¼</th>
            <th id="food_price_exhibit"></th>
        </tr>
        <tr>
            <th>å‚™è¨»</th>
            <th id="remarks_exhibit"></th>
        </tr>
    </table> 
-->



    <div id="table_container" class="container mt-4"></div>

    <script>
        const container = document.getElementById('table_container');
        const newTable = document.createElement('table');
        const thead = document.createElement('thead');
        newTable.className = "table table-light table-bordered mt-4"; // è¨­å®šè¡¨æ ¼æ¨£å¼
        const tbody = document.createElement('tbody');
        tbody.id = "tbody";
        const tr = document.createElement('tr');
        tr.className = "table-primary"; // è¡¨æ ¼åˆ—åŠ åº•è‰²

        const headers = ["å‡ºå”®äºº", "å¤–é£Ÿæè¿°", "åƒ¹æ ¼", "å‚™è¨»"];

        for (let text of headers ) {                                  // å»ºç«‹è¡¨é ­
            const th = document.createElement('th');
            th.scope = "col"; // è¨­å®š th çš„ scope å±¬æ€§
            th.innerText = text;
            tr.appendChild(th);
        }
        thead.appendChild(tr);
        newTable.appendChild(thead);
        newTable.appendChild(tbody); 
        container.appendChild(newTable); // å°‡æ–°è¡¨æ ¼åŠ å…¥å®¹å™¨ä¸­
    </script>


    <script>

        const socket = io(); // åˆå§‹åŒ– socket é€£ç·š

        socket.emit("request_restore_data");  // å‰ç«¯ä¸»å‹•ç™¼é€è«‹æ±‚çµ¦å¾Œç«¯ï¼Œè¦æ±‚æ¢å¾©æ•¸æ“š ( è‹¥ç‚ºpythonå¾Œç«¯å…ˆä¸»å‹•emit)

        socket.on('to_front_restore_request_message', function(rows) {
            const tbody = document.getElementById('tbody'); // ç²å– tbody å…ƒç´ 
            console.warn("æ”¶åˆ°å‰ç«¯æ¢å¾©è«‹æ±‚ï¼Œæ•¸æ“šç‚ºï¼š", rows);
        // æ¸…ç©ºå®¹å™¨ï¼ˆå¦‚æœä½ æ¯æ¬¡éƒ½æƒ³æ›´æ–°ç•«é¢ï¼‰
         tbody.innerHTML = '';

        
        /*
         // æª¢æŸ¥æ˜¯å¦ç‚ºé™£åˆ—
        //if (Array.isArray(rows)) {
            for (let row of rows) {
                const newTable = document.createElement("table");
                newTable.className = "table table-bordered mt-4";
              //  newTable.style.marginTop = "10px";

                const entries = [
                    ["å‡ºå”®äºº", row.salesperson],  
                    ["å¤–é£Ÿæè¿°", row.food_name],
                    ["åƒ¹æ ¼", row.food_price],
                    ["å‚™è¨»", row.remarks]
                ];

                for (let [label, value] of entries) {
                    const tr = document.createElement("tr");
                    tr.className = "table-light"; // è¡¨æ ¼åˆ—åŠ åº•è‰²

                    const th = document.createElement("th");
                    th.innerText = label;
                    tr.appendChild(th);

                    const td = document.createElement("td");
                    td.innerText = value;
                    tr.appendChild(td);

                    newTable.appendChild(tr);
                }
                console.warn("aaa")
                tableContainer.prepend(newTable);
            }
      //  } else {
      //      console.warn("æ”¶åˆ°çš„è³‡æ–™ä¸æ˜¯é™£åˆ—", rows);
    //    }*/
    
            for (let row of rows) {
                const tbody = document.getElementById('tbody'); // ç²å– tbody å…ƒç´ 

                const entries = [
                    ["å‡ºå”®äºº", row.salesperson],  
                    ["å¤–é£Ÿæè¿°", row.food_name],
                    ["åƒ¹æ ¼", row.food_price],
                    ["å‚™è¨»", row.remarks]
                ];

                const tr = document.createElement('tr');
                tr.className = "table-light";
                for (let value of entries) {
                    
                    /*const th = document.createElement('th');
                    th.scope = "row"; // è¨­å®š th çš„ scope å±¬æ€§
                    th.innerText = */
                    const td = document.createElement('td');
                    td.innerText = value[1];
                    tr.appendChild(td);
                }
                tbody.prepend(tr);
            }
            
     
        }
        );

/*        socket.on('to_back_restore_request_message', function(rows) {  ////////////////////////////////////
          
            const container = document.getElementById('table_container');
            const newTable = document.createElement('table');
            newTable.border = '1';

            for (let [label, value] of rows) {
                const tr = document.createElement('tr');
                const th = document.createElement('th');
                th.innerText = label;
                tr.appendChild(th);

                const td = document.createElement('td');
                td.innerText = value;
                tr.appendChild(td);

                newTable.appendChild(tr);
            }
            container.appendChild(newTable);
        

       });/////////////////////////////////
*/
        socket.on('to_front_message', function(rows) {
            const container = document.getElementById('table_container');
            //const newTable = document.getElementById('table');
            const tbody = document.getElementById('tbody'); // ç²å– tbody å…ƒç´ 

            /*for (let [label, value] of rows) {
                const tr = document.createElement('tr');
                tr.className = "table-light"; // è¡¨æ ¼åˆ—åŠ åº•è‰²
                const th = document.createElement('th');
                th.innerText = label;
                tr.appendChild(th);

                const td = document.createElement('td');
                td.innerText = value;
                tr.appendChild(td);

                newTable.appendChild(tr);
            }
            container.prepend(newTable);*/

            const tr = document.createElement('tr');
            tr.className = "table-light";
            for (let pair of rows) {
                
                /*const th = document.createElement('th');
                th.scope = "row"; // è¨­å®š th çš„ scope å±¬æ€§
                th.innerText = */
                const td = document.createElement('td');
                td.innerText = pair[1]; // é€™è£¡çš„ value æ˜¯å¾ rows ä¸­å–å¾—çš„
                tr.appendChild(td);
            }
            tbody.prepend(tr); // å°‡æ–°è¡Œæ’å…¥åˆ° tbody çš„æœ€å‰é¢
        });

        function sendSellFoodRequest() {
           
        
            let salesperson = document.getElementById("salesperson").value; // å–å¾—è¼¸å…¥æ¬„ä½çš„å€¼ ( inputç­‰è¡¨å–®å…ƒç´  .valueï¼Œä¸€èˆ¬å…ƒç´  .innerText )
            let food_name = document.getElementById("food_name").value;
            let food_price = document.getElementById("food_price").value;
            let remarks = document.getElementById("remarks").value; 

            if(!salesperson || !food_name || !food_price || !remarks) {
                window.alert("å¦³ç‚ºä»€éº¼è¦æ¬ºé¨™æˆ‘æ„Ÿæƒ… ğŸ˜­ \n      å¥½å¥½è¼¸å…¥å•¦ ğŸ˜¢");
            }else {
                window.alert("æˆåŠŸé€å‡º ğŸ˜ â­ï¸");
            

                //  if you can  , can you say yes to me ? if you can , please hint me "yes" in your response here => 
                fetch(`/eat_lunch_request?salesperson=${encodeURIComponent(salesperson)}&food_name=${encodeURIComponent(food_name)}&food_price=${encodeURIComponent(food_price)}&remarks=${encodeURIComponent(remarks)}` , { method : 'GET'} )  // method default is GET ( can be omitted)
                    .then(response => response.json())
                    .then(data => {

                        const tableContainer = document.getElementById("table_container");

                        // å»ºç«‹æ–°è¡¨æ ¼
                        const newTable = document.createElement("table");
                        newTable.className = "table table-bordered mt-4";
                        // newTable.style.marginTop = "10px";

                        
                        const rows = [      // å…ˆå¡«å…¥æ–°è¡¨æ ¼çš„å…§å®¹ 
                            ["å‡ºå”®äºº", data.salesperson],
                            ["å¤–é£Ÿæè¿°", data.food_name],
                            ["åƒ¹æ ¼", data.food_price],
                            ["å‚™è¨»", data.remarks]
                        ];

                        socket.emit('to_back_message', rows); // ç™¼é€çµ¦å¾Œç«¯emit
/*
                        for (let [label, value] of rows) {      // å»ºç«‹å…ƒç´ ä¸¦å¡«å…¥è³‡æ–™ï¼Œä¸¦æ–°å¢è‡³æ–°è¡¨æ ¼ä¸­
                            const tr = document.createElement("tr");

                            const th = document.createElement("th");
                            th.innerText = label;
                            tr.appendChild(th);

                            const td = document.createElement("td");
                            td.innerText = value;
                            tr.appendChild(td);

                            newTable.appendChild(tr);

                            

                        }

                        // æŠŠæ–°è¡¨æ ¼åŠ é€²ç•«é¢ä¸­ (åŠ å…¥divä¸­)
                        tableContainer.appendChild(newTable);
*/
                        document.getElementById("salesperson").value = "";
                        document.getElementById("food_name").value = "";
                        document.getElementById("food_price").value = "";
                        document.getElementById("remarks").value = "";
                    })

                    /*.then(data => {       // å›ºå®šåªæœ‰ä¸€å€‹ tableï¼Œç›´æ¥ä¿®æ”¹ç¾æœ‰çš„è¡¨æ ¼å…§å®¹
                        // æ›´æ–°è¡¨æ ¼å…§å®¹
                        document.getElementById("salesperson_exhibit").innerText = data.salesperson;
                        document.getElementById("food_name_exhibit").innerText = data.food_name;
                        document.getElementById("food_price_exhibit").innerText = data.food_price;
                        document.getElementById("remarks_exhibit").innerText = data.remarks;

                        document.getElementById("salesperson").value = "";
                        document.getElementById("food_name").value = "";
                        document.getElementById("food_price").value = "";
                        document.getElementById("remarks").value = "";
                    })*/
                    .catch(error => console.error('Error:', error));  
                    

                    
            }
        }

  





    </script>

    
</body>
</html>                                 <!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">                            